var documenterSearchIndex = {"docs":
[{"location":"charged_particle_3d/#Charged-Particles-in-3D","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"","category":"section"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"The motion of charged particles in an electromagnetic field (EB) is governed by the Lorentz force,","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"ddotx (t) = fracem big E(x(t)) + dotx (t) times B(x(t)) big ","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"where m and e denote the particle's mass and charge, respectively.","category":"page"},{"location":"charged_particle_3d/#Canonical-Formulation","page":"Charged Particles in 3D","title":"Canonical Formulation","text":"","category":"section"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"The canonical form of the equations can be obtained from the Hamiltonian","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"H (xp) = frac12m (p-A(x))^2 + e phi(x)","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"as","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"beginaligned\ndotx (t) = fracpartial Hpartial p (x(t)p(t)) = frac1m (p(t) - A(x(t))) \ndotp (t) = - fracpartial Hpartial x (x(t)p(t)) = frac1m nabla A(x(t)) cdot (p(t)-A(x(t))) - nabla phi(x(t)) \nendaligned","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"where the fields (EB) are related to the potentials (phi A) by","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"beginaligned\nE (x) = - nabla phi (x)  \nB (x) = nabla times A (x) \nendaligned","category":"page"},{"location":"charged_particle_3d/#Noncanonical-Formulation","page":"Charged Particles in 3D","title":"Noncanonical Formulation","text":"","category":"section"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"The noncanonical form of the equations can be obtained from the phasespace Lagrangian","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"beginaligned\nL (xdotxvdotv) = (e A(x) + mv) cdot dotx - H(xv)  \nH(xv) = fracm2 v^2 + e phi(x)\nendaligned","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"as","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"beginaligned\ndotx (t) = v (t)  \ndotv (t) = fracem big nabla A (x(t)) cdot dotx(t) - dotA (x(t)) - nabla phi(x(t)) big \nendaligned","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"Computing the time derivative of A and using the relation between the potentials (phi A) and the fields (EB), this can be rewritten as","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"beginaligned\ndotx (t) = v (t)  \ndotv (t) = fracem big E(x(t)) + v (t) times B(x(t)) big \nendaligned","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"This constitutes a noncanonical Hamiltonian system of the form","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"dotz (t) = Omega^-T (z(t)) nabla H(z(t)) ","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"with z = (xv) and the symplectic matrix Omega given by","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"Omega = frac1m beginpmatrix\n  mathbb0  mathbb1 \n- mathbb1  e hatB \nendpmatrix ","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"and","category":"page"},{"location":"charged_particle_3d/","page":"Charged Particles in 3D","title":"Charged Particles in 3D","text":"hatB = beginpmatrix\n0  -B_3  B_2 \nB_3  0  - B_1 \n- B_2  B_1  0 \nendpmatrix ","category":"page"},{"location":"charged_particle_3d/#Modules","page":"Charged Particles in 3D","title":"Modules","text":"","category":"section"},{"location":"charged_particle_3d/#ChargedParticleDynamics.ChargedParticle3d.SingularField","page":"Charged Particles in 3D","title":"ChargedParticleDynamics.ChargedParticle3d.SingularField","text":"Charged Particle in a singular magnetic field of the form B(xyz) = (x^2 + y^2)^-32 e_z.\n\n\n\n\n\n","category":"module"},{"location":"charged_particle_3d/#ChargedParticleDynamics.ChargedParticle3d.SymmetricField","page":"Charged Particles in 3D","title":"ChargedParticleDynamics.ChargedParticle3d.SymmetricField","text":"Charged Particle in an axisymmetric magnetic field of the form B(xyz) = (1 + x^2 + y^2) e_z.\n\n\n\n\n\n","category":"module"},{"location":"charged_particle_3d/#ChargedParticleDynamics.ChargedParticle3d.ThetaPinchCanonical","page":"Charged Particles in 3D","title":"ChargedParticleDynamics.ChargedParticle3d.ThetaPinchCanonical","text":"Charged Particle in an uniform magnetic field of the form B(xyz) = B_0 e_z.\n\n\n\n\n\n","category":"module"},{"location":"normalization/#Normalization","page":"Normalization","title":"Normalization","text":"","category":"section"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"In order to normalize the equations of the various models implemented in this package, we start at the level of the Lagrangian. In the following, this is explained exemplary for the charged particle Lagrangian, however, it generalizes straightforwardly to other systems like the Pauli particle or the guiding center system.","category":"page"},{"location":"normalization/#Charged-Particle-Lagrangian","page":"Normalization","title":"Charged Particle Lagrangian","text":"","category":"section"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"Consider the phasespace Lagrangian","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"L (q dotq v) = ( mv + A (x) ) cdot dotx  - fracm2 vert v vert^2  - e phi (x) ","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"and, in full generality, introduce the following normalizations:","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"t = hatt t  quad\nx = hatx x  quad\nv = hatv v  quad\nA = hatA A  quad\nphi = hatphi phi  quad\nL = hatL L  ","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"This leads us to","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"L\n= fracLhatL\n= frac1hatL  big( m hatv v + e hatA A big) cdot frachatxhatt dotx - fracm hatv^2hatL fracvert v vert^22 - frace hatphihatL phi ","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"Let us choose the following normalizations (and note that others are possible and may be more appropriate, depending on the problem at hand):","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"beginaligned\nhatA = hatl hatB  \nhatphi = hatl hatE  \nhatL = m hatv^2 = e hatphi \nendaligned","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"with the characteristic length l. The normalized Lagrangian becomes","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"L = bigg( frachatxhatt hatv  v + underbracefrace hatBm_hatomega_c frachatx hatl hatt hatv^2  A bigg) cdot dotx - fracvert v vert^22 - phi ","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"where hatomega_c = e hatB  m is the characteristic gyration frequency. This suggests to set","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"beginaligned\nhatt = hatomega_c^-1  \nhatx = hatl  \nhatv = frachatxhatt = hatl hatomega_c \nendaligned","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"so that","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"L = ( v + A ) cdot dotx - fracvert v vert^22 - phi ","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"We thus have obtained the normalized Lagrangian.","category":"page"},{"location":"normalization/#Strongly-Magnetized-Plasmas","page":"Normalization","title":"Strongly Magnetized Plasmas","text":"","category":"section"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"Often, especially when simulating an ensemble of particles, it is more appropriate to normalize the velocity to the thermal velocity and to choose different length scales for hatx and hatl, specifically","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"beginaligned\nhatv = v_mathrmth  \nhatt = hatomega_c^-1  \nhatA = hatl hatB  \nhatphi = hatl hatE  \nhatL = m v_mathrmth^2 \nendaligned","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"where v_mathrmth = sqrt W  m denotes the thermal velocity and W = k_B T the thermal energy. Consequently,","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"L = bigg( frachatxhatt fracm hatvm v_mathrmth^2  v + frachatomega_c^2v_mathrmth^2  hatx hatl  A bigg) cdot dotx - fracm hatvm v_mathrmth^2 fracvert v vert^22 - frace hatphim v_mathrmth^2 phi ","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"Further, set","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"beginaligned\nhatx = hatv hatt = fracv_mathrmthhatomega_c = hatrho_mathrmth \nendaligned","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"where hatrho_mathrmth is the characteristic gyro radius, and the normalized Lagrangian becomes","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"L = bigg( v + frachatlhatrho_mathrmth  A bigg) cdot dotx - fracvert v vert^22 - frace hatphim v_mathrmth^2 phi ","category":"page"},{"location":"normalization/","page":"Normalization","title":"Normalization","text":"This leaves room for different orderings and consequently different normalizations.  For example, in drift kinetics, we have hatrho_mathrmth  hatl sim epsilon and e hatphi  m v_mathrmth^2 sim 1, while in gyro kinetics, we have hatrho_mathrmth  hatl sim 1 and e hatphi  m v_mathrmth^2 sim epsilon. ","category":"page"},{"location":"initialization/#Initialization","page":"Initialization","title":"Initialization","text":"","category":"section"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"In the following, we will discuss how to initialise the various models from a common set of initial data, namely","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"the guiding center position X in physical coordinates,\nthe particle energy W in eV,\nthe particle mass m in kg,\nthe particle charge number,\nthe gyro angle theta in 0 2pi,\nthe pitch angle alpha in 0 pi  2.","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"For charged particles we need to convert the energy into a velocity vector. For the Pauli particle we need to compute the coordinates of the guiding centre X of the particle and construct a velocity vector that only holds the component of the velocity that is parallel to the magnetic field, while the perpendicular component goes into the magnetic moment mu. For the guiding center, we need the same coordinate transformation as for the Pauli particle, but we only need the absolute value of the velocity in direction of the magnetic field u and the magnetic moment mu.","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"Make sure to read about the Normalization before proceeding.","category":"page"},{"location":"initialization/#Velocities","page":"Initialization","title":"Velocities","text":"","category":"section"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"Set e = e hate with e = 1602 176 634 cdot 10^-19 and hate = mathrmC and similarly m = m hatm with hatm = mathrmkg. Some common values for the mass are","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"Particle Normalised Mass m\nelectron 91093837015 cdot 10^-31\nproton 16726219237 cdot 10^-27\ndeuteron 33435837724 cdot 10^-27\nalpha 66446573357 cdot 10^-27","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"The absolute value of the velocity is obtained from the particle energy by vert v vert^2 = 2 W  m. In normalised units, we have W = W hatW and v = v hatv where hatW = e mathrmV and hatv = hatl hatomega_c = hatl hatB e  m.","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"Let us compute the normalise kinetic energy,","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"fracvert v vert^22\n= fracW hatWm hatv^2\n= fracW e mathrmV m^2m hatl^2 hatB^2 e^2 ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"Usually, we have hatB = T = mathrmkg  mathrmC mathrms. Recall that mathrmV = mathrmkg mathrmm^2  mathrmC mathrms^2 and let us set hatl = l_0 mathrmm, then","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"fracvert v vert^22 = fracm We l_0^2 ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"Thus for the absolute value of the velocity we have","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"vert v vert = frac1l_0 sqrt 2 W  fracme  ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"The pitch angle alpha determines the distribution of the kinetic energy into the perpendicular and parallel components by","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"beginaligned\nW_perp = W sin alpha  qquad\nW_parallel = W  (1 - sin alpha) \nendaligned","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"and accordingly","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"beginaligned\nvert v_perp vert = frac1l_0 sqrt 2 W_perp  fracme   qquad\nvert v_parallel vert = frac1l_0 sqrt 2 W_parallel  fracme  \nendaligned","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"The ElectromagneticFields.jl package provides three functions a⃗(t,x), b⃗(t,x), c⃗(t,x) that can be used to construct the velocity vector v. The function b⃗ returns the unit vector of the magnetic field, thus","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"v_parallel = vert v vert  (1 - sin alpha)  b ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"The functions a⃗ and c⃗ return two unit vectors that span the plane perpendicular to the magnetic field, thus","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"v_perp = vert v vert  sin alpha ( - a  sin theta - c  cos theta ) ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"where theta is the gyro angle. The magnetic moment is computed as","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"mu = frac vert v_perp vert^2 2 vert B vert = frac vert v vert^2 sin alpha 2 vert B vert ","category":"page"},{"location":"initialization/#Gyro-radius-Vector-and-Position","page":"Initialization","title":"Gyro-radius Vector and Position","text":"","category":"section"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"In order to compute the particle position, we need to construct the gyro radius vector rho, which is given by","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"rho = fracb times vomega_c = fracb times hatv vhatomega_c omega_c  = l_0  fracb times vvert B vert ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"Note that ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"omega_c\n= frace vert B vertm\n= frace vert hatB B vertm\n= frace vert hatB vertm vert B vert\n= hatomega_c omega_c ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"as","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"hatomega_c = frace vert hatB vertm ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"so that","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"omega_c = vert B vert ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"The normalized gyro radius vector reads","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"rho = fracrhol_0 = fracb times vvert B vert ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"so that the normalised particle position is","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"x = X + rho ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"The gyro phase theta is defined as the angle, measured in the clockwise sense, between a and rho, so that","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"fracb times vvert v vert  sin alpha = a  cos theta - c  sin theta ","category":"page"},{"location":"initialization/#Guiding-Center-Coordinates","page":"Initialization","title":"Guiding Center Coordinates","text":"","category":"section"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"Instead of the particle energy W and pitch angle alpha, we can also compute all initial conditions from the guiding center initial data, i.e., parallel velocity u = vert v_parallel vert, magnetic moment mu and gyro angle theta.","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"Start by computing the absolute value of the perpendicular velocity by","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"vert v_perp vert = sqrt 2 mu vert B vert  ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"and the total velocity by","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"vert v vert = sqrt vert v_parallel vert^2 + vert v_perp vert^2  ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"With that, we can compute the perpendicular and total energy,","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"beginaligned\nW_perp = frace l₀^2 vert v_perp vert^22m  qquad\nW = frace l₀^2 vert v vert^22m \nendaligned","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"The pitch angle is obtained as","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"alpha = arcsin fracW_perpW ","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"With that, the rest of the quantities can be computed in the same way as above.","category":"page"},{"location":"initialization/#Initial-Conditions","page":"Initialization","title":"Initial Conditions","text":"","category":"section"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"ChargedParticleDynamics.jl provides the InitialConditions module for the computation of the above quantities. Three functions are provided that return the initial conditions for the different models. For charged particles the initial conditions are (x v), for the Pauli particle we have (X v_parallel mu) and for the guiding center we use (X u mu) with u = vert v_parallel vert.","category":"page"},{"location":"initialization/#ChargedParticleDynamics.InitialConditions","page":"Initialization","title":"ChargedParticleDynamics.InitialConditions","text":"Store initial conditions for charged particle, Pauli particle and guiding center models.\n\nFields:\n\nx: particle position\nX: gyro center position\nρ: gyro radius vector\nvvec: velocity vector\nvpar: parallel velocity vector\nvper: perpendicular velocity vector\nv: absolute value of velocity\nu: absolute value of parallel velocity\nμ: magnetic moment\nθ: gyro angle ∈ [0,2π]\nα: pitch angle ∈ [0,π/2]\nω: gyro frequency\nmass: mass in kg\nenergy: energy in eV\ncharge: charge number\n\n\n\n\n\n","category":"type"},{"location":"initialization/#ChargedParticleDynamics.InitialConditions-Union{Tuple{T}, Tuple{AbstractVector{T}, T, T, T, T, Any, Vararg{Function, 8}}} where T","page":"Initialization","title":"ChargedParticleDynamics.InitialConditions","text":"Compute initial conditions from the following arguments:\n\nX: gyro center position\nθ: gyro angle\nα: pitch angle\nE: energy\nM: mass\nC: charge number\na, b, c: magnetic field unit vectors in physical coordinates\nb: magnetic field unit vector in contravariant coordinates\nB: amplitude of magnetic field\ng̅: inverse metric coefficients\nDF̄: inverse Jacobian matrix\nJ: Jacobian determinant\nl=1: length normalization\n\n\n\n\n\n","category":"method"},{"location":"initialization/#ChargedParticleDynamics.InitialConditionsGC-Union{Tuple{T}, Tuple{AbstractVector{T}, T, T, T, T, Any, Vararg{Function, 8}}} where T","page":"Initialization","title":"ChargedParticleDynamics.InitialConditionsGC","text":"Compute initial conditions from the following arguments:\n\nX: gyro center position\nθ: gyro angle\nu: absolute value of parallel velocity\nμ: magnetic moment\nM: mass\nC: charge number\na, b, c: magnetic field unit vectors in physical coordinates\nb: magnetic field unit vector in contravariant coordinates\nB: amplitude of magnetic field\ng̅: inverse metric coefficients\nDF̄: inverse Jacobian matrix\nJ: Jacobian determinant\nl=1: length normalization\n\n\n\n\n\n","category":"method"},{"location":"initialization/#ChargedParticleDynamics.charged_particle-Union{Tuple{InitialConditions{T}}, Tuple{T}} where T","page":"Initialization","title":"ChargedParticleDynamics.charged_particle","text":"Extracts the charged particle initial conditions and returns the tuple (x,v). If the keyword argument noncanonical is set to true, the functions returns the vector vcat(x,v).\n\n\n\n\n\n","category":"method"},{"location":"initialization/#ChargedParticleDynamics.guiding_center-Union{Tuple{InitialConditions{T}}, Tuple{T}} where T","page":"Initialization","title":"ChargedParticleDynamics.guiding_center","text":"Extracts the guiding center initial conditions and returns the tuple (vcat(X,u),μ).\n\n\n\n\n\n","category":"method"},{"location":"initialization/#ChargedParticleDynamics.pauli_particle-Union{Tuple{InitialConditions{T}}, Tuple{T}} where T","page":"Initialization","title":"ChargedParticleDynamics.pauli_particle","text":"Extracts the Pauli particle initial conditions and returns the tuple (X,vpar,μ). If the keyword argument noncanonical is set to true, the functions returns the tuple (vcat(X,vpar),μ).\n\n\n\n\n\n","category":"method"},{"location":"initialization/#Example","page":"Initialization","title":"Example","text":"","category":"section"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"As an example, let us consider a deuteron in an ITER-like analytical equilibrium (obtained from ElectromagneticFields.SolovevITER). The guiding center position is 7 0 0, the energy is 1  mathrmMeV, and the pitch angle is pi  2.","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"using LaTeXStrings\nusing Markdown\nusing Plots\n\np = palette(:tab10)\nrectangle(x, y, w, h) = Shape(x .+ [-w/2,-w/2,+w/2,+w/2], y .+ [-h/2,+h/2,+h/2,-h/2])\n\nusing ChargedParticleDynamics\nusing ChargedParticleDynamics: md\n\nimport ElectromagneticFields: code\nimport ElectromagneticFields.Solovev: SolovevEquilibrium\nimport ElectromagneticFields.SolovevITER: init\nequ = init()\n@eval $(code(equ))\n\nX₀ = from_cartesian(0, [7.0, 0, 0])\nE₀ = 1E6\nθ₀ = 0.\nα₀ = π/4\nm₀ = md\n\nic0 = InitialConditions(X₀, θ₀, α₀, E₀, m₀, 1, aₚ, bₚ, cₚ, b⃗, B, ḡ, DF̄, J; l₀=R₀)\n\nnp = 12\nnr = 100\nnz = 120\n\nxgrid = LinRange( 0.5,   1.5, nr)\nygrid = LinRange(-0.75, +0.75, nz)\nfieldlines = zeros((nr,nz))\n\nfor i in 1:nr\n    for j in 1:nz\n        fieldlines[i,j] = A₃(0, xgrid[i], ygrid[j], 0.0) / xgrid[i]\n    end\nend\n\npx = zeros(np)\npy = zeros(np)\n\nfor i in 1:np\n    ics = charged_particle(InitialConditions(X₀, 2π*i/np, α₀, E₀, m₀, 1, aₚ, bₚ, cₚ, b⃗, B, ḡ, DF̄, J; l₀=R₀))\n    px[i] = ics[1][1]\n    py[i] = ics[1][2]\nend\n\nboxw=0.008\nboxh=0.008\n\nplot(aspectratio=1, layout=(1,2), legend=:none, size=(800,600), xguide=L\"R/R_0\", yguide=L\"Z/R_0\")\nplot!(subplot=1, rectangle(X₀[1], X₀[2], 0.1, 0.1), opacity=.5, color=:white)\n\nplot!(subplot=1, xlims=(0.5,1.5), ylims=(-0.75,+0.75))\nplot!(subplot=2, xlims=(X₀[1] .+ [-boxw,+boxw]), ylims=(X₀[2] .+ [-boxh,+boxh]))\n\ncontour!(subplot=1, xgrid, ygrid, fieldlines', levels=50)\nscatter!(subplot=1, px, py, color=p[1])\nscatter!(subplot=1, [X₀[1]], [X₀[2]], color=p[4])\n\nscatter!(subplot=2, px, py, color=p[1])\nscatter!(subplot=2, [X₀[1]], [X₀[2]], color=p[4])\n\nsavefig(\"initial_conditions.png\")\n\nMarkdown.parse(\"\"\"\n| Fields     | Value |\n|:-----------|:------|\n| `x`   | $(ic0.x)  |\n| `X`   | $(ic0.X)  |\n| `ρ`   | $(ic0.ρ)  |\n| `v⃗`   | $(ic0.vvec)  |\n| `v∥`  | $(ic0.vpar)  |\n| `v⟂`  | $(ic0.vper)  |\n| `v`   | $(ic0.v)  |\n| `u`   | $(ic0.u)  |\n| `μ`   | $(ic0.μ)  |\n| `θ`   | $(ic0.θ)  |\n| `α`   | $(ic0.α)  |\n| `ω`   | $(ic0.ω)  |\n| `M`   | $(ic0.mass)  |\n| `E`   | $(ic0.energy)  |\n| `C`   | $(ic0.charge)  |\n\"\"\")","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"Below we plot the guiding center position (in red) and the particle position (in blue) in the poloidal plane for various gyro angles in 0 2pi.","category":"page"},{"location":"initialization/","page":"Initialization","title":"Initialization","text":"(Image: )","category":"page"},{"location":"pauli_particle_3d/#Pauli-Particles-in-3D","page":"Pauli Particles in 3D","title":"Pauli Particles in 3D","text":"","category":"section"},{"location":"pauli_particle_3d/#Modules","page":"Pauli Particles in 3D","title":"Modules","text":"","category":"section"},{"location":"pauli_particle_3d/#ChargedParticleDynamics.PauliParticle3d.SymmetricField","page":"Pauli Particles in 3D","title":"ChargedParticleDynamics.PauliParticle3d.SymmetricField","text":"Charged Particle in an axisymmetric magnetic field of the form B(xyz) = (1 + x^2 + y^2) e_z.\n\n\n\n\n\n","category":"module"},{"location":"pauli_particle_3d/#ChargedParticleDynamics.PauliParticle3d.ThetaPinchField","page":"Pauli Particles in 3D","title":"ChargedParticleDynamics.PauliParticle3d.ThetaPinchField","text":"Charged Particle in an uniform magnetic field of the form B(xyz) = B_0 e_z.\n\n\n\n\n\n","category":"module"},{"location":"#ChargedParticleDynamics.jl","page":"Overview","title":"ChargedParticleDynamics.jl","text":"","category":"section"},{"location":"","page":"Overview","title":"Overview","text":"(Image: CI) (Image: Build Status) (Image: Coverage Status) (Image: codecov)","category":"page"},{"location":"#General","page":"Overview","title":"General","text":"","category":"section"},{"location":"","page":"Overview","title":"Overview","text":"Pages = [\"normalization.md\",\n         \"initialization.md\",\n]","category":"page"},{"location":"#Models","page":"Overview","title":"Models","text":"","category":"section"},{"location":"","page":"Overview","title":"Overview","text":"Pages = [\"charged_particle_3d.md\",\n         \"guiding_center_4d.md\",\n         \"pauli_particle_3d.md\",\n]","category":"page"},{"location":"#Acknowledgements","page":"Overview","title":"Acknowledgements","text":"","category":"section"},{"location":"","page":"Overview","title":"Overview","text":"Stefan Possaner contributed vitally to sorting out the appalling details of normalization and initialization.","category":"page"},{"location":"#License","page":"Overview","title":"License","text":"","category":"section"},{"location":"","page":"Overview","title":"Overview","text":"Copyright (c) Michael Kraus <michael.kraus@ipp.mpg.de>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.","category":"page"},{"location":"guiding_center_4d/#Guiding-Center-Dynamics-in-4D","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"","category":"section"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"Guiding centre dynamics is a reduced version of charged particle dynamics, where the motion of the particle in a strong magnetic field B is reduced to the motion of the guiding centre, that is the centre of the gyro motion of the particle about a magnetic field line. The dynamics of the guiding centre can be described in terms of only four coordinates (as compared to six for the full motion of the charged particle), the position of the guiding centre r = (xyz) and the parallel velocity u, where parallel refers to the direction of the magnetic field.","category":"page"},{"location":"guiding_center_4d/#Lagrangian-Formulation","page":"Guiding Center Dynamics in 4D","title":"Lagrangian Formulation","text":"","category":"section"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"The simplest form of the guiding centre equations can be obtained from the Lagrangian","category":"page"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"beginaligned\nL = (A (r) + u b (r)) cdot dotr - H(ru)  \nH = tfrac12 u^2 + mu vert B (r) vert \nendaligned","category":"page"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"where b = B  vert B vert is the unit vector of the magnetic field B = nabla times A with A the magnetic vector potential and mu is the magnetic moment. The Euler-Lagrange equations are computed as","category":"page"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"beginaligned\nnabla vartheta^T ( r(t) u(t) ) cdot dotr (t) - dotvartheta ( r(t) u(t) ) = nabla H ( r(t) u(t) )  \nb ( r(t) ) cdot dotr (t) = u (t) \nendaligned","category":"page"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"with vartheta(ru) = A (r) + u  b (r) and the gradient nabla denoting the derivative with respect to r.","category":"page"},{"location":"guiding_center_4d/#Hamiltonian-Formulation","page":"Guiding Center Dynamics in 4D","title":"Hamiltonian Formulation","text":"","category":"section"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"Computing the time derivative of vartheta, the Euler-Lagrange equations can be rewritten in an explicit form as","category":"page"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"beginaligned\ndotr (t) = dfracu (t)  beta (r (t))b (r (t)) cdot beta (r (t)) + dfracB (r (t))B (r (t)) cdot beta (r (t)) times nabla H (r (t)u (t))  \ndotu (t) = - dfracbeta (r (t))b (r (t)) cdot beta (r (t)) cdot nabla H (r (t) u (t)) \nendaligned","category":"page"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"where beta = nabla times vartheta. This constitutes a noncanonical Hamiltonian system of the form","category":"page"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"dotq = Omega^-T (q) nabla H(q) ","category":"page"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"with q = (xyzu) and the symplectic matrix Omega given by","category":"page"},{"location":"guiding_center_4d/","page":"Guiding Center Dynamics in 4D","title":"Guiding Center Dynamics in 4D","text":"Omega_ij = dfracpartial vartheta_jpartial q^i - dfracpartial vartheta_ipartial q^j ","category":"page"},{"location":"guiding_center_4d/#Modules","page":"Guiding Center Dynamics in 4D","title":"Modules","text":"","category":"section"},{"location":"guiding_center_4d/#ChargedParticleDynamics.GuidingCenter4d.SymmetricField","page":"Guiding Center Dynamics in 4D","title":"ChargedParticleDynamics.GuidingCenter4d.SymmetricField","text":"First and second Poincaré invariant for a guiding center particle in an axisymmetric magnetic field of the form B(xyz) = B_0 (1 + x^2 + y^2) e_z.\n\nThe loop for the first invariant is initialized by\n\nq (tau) = beginpmatrix\nr_x cos (2pi tau) \nr_y sin (2pi tau) \nz_0 + z_1 sin (2pi tau) \nu_0 + u_1 cos (2pi tau) \nendpmatrix\n\nwith parameters\n\nB_0 = 1 quad\nr_x = 05 quad\nr_y = 03 quad\nz_0 = 00 quad\nz_1 = 01 quad\nu_0 = 05 quad\nu_1 = 005 quad\nmu = 001 \n\nThe surface for the second invariant is initialized by\n\nq (tau) = beginpmatrix\nr_0 (sigma - 05) \nr_0 (tau   - 05) \nz_0 + z_1 cos (2pi sigma) cos (2pi tau) \nu_0 + u_1 sin (2pi sigma) sin (2pi tau) \nendpmatrix\n\nwith parameters\n\nB_0 = 1 quad\nr_0 = 05 quad\nz_0 = 00 quad\nz_1 = 01 quad\nu_0 = 05 quad\nu_1 = 001 quad\nmu = 001 \n\n\n\n\n\n","category":"module"},{"location":"guiding_center_4d/#ChargedParticleDynamics.GuidingCenter4d.ThetaPinchField","page":"Guiding Center Dynamics in 4D","title":"ChargedParticleDynamics.GuidingCenter4d.ThetaPinchField","text":"First Poincaré invariant for a guiding center particle in an θ-pinch magnetic field of the form B(xyz) = B_0  e_z.\n\nThe loop for the first Poincaré invariant is initialized by\n\nq (tau) = beginpmatrix\nr_x cos (2pi tau) \ny_0 \nr_z sin (2pi tau) \nendpmatrix\n\nwith parameters\n\nB_0 = 1 quad\nr_x = 05 quad\nr_z = 03 quad\ny_0 = 00 quad\nu_0 = 05 quad\nmu = 25 times 10^-6 \n\n\n\n\n\n","category":"module"},{"location":"guiding_center_4d/#ChargedParticleDynamics.GuidingCenter4d.TokamakSmallCartesian","page":"Guiding Center Dynamics in 4D","title":"ChargedParticleDynamics.GuidingCenter4d.TokamakSmallCartesian","text":"Analytic axisymmetric small tokamak equilibrium in cartesian coordinates.\n\n\n\n\n\n","category":"module"},{"location":"guiding_center_4d/#ChargedParticleDynamics.GuidingCenter4d.TokamakSmallCylindrical","page":"Guiding Center Dynamics in 4D","title":"ChargedParticleDynamics.GuidingCenter4d.TokamakSmallCylindrical","text":"Analytic axisymmetric small tokamak equilibrium in cylindrical coordinates.\n\n\n\n\n\n","category":"module"},{"location":"guiding_center_4d/#ChargedParticleDynamics.GuidingCenter4d.TokamakSmallToroidal","page":"Guiding Center Dynamics in 4D","title":"ChargedParticleDynamics.GuidingCenter4d.TokamakSmallToroidal","text":"Analytic axisymmetric small tokamak equilibrium in circular coordinates.\n\n\n\n\n\n","category":"module"},{"location":"guiding_center_4d/#ChargedParticleDynamics.GuidingCenter4d.TokamakMediumCartesian","page":"Guiding Center Dynamics in 4D","title":"ChargedParticleDynamics.GuidingCenter4d.TokamakMediumCartesian","text":"Analytic axisymmetric medium-size tokamak equilibrium in cartesian coordinates.\n\n\n\n\n\n","category":"module"},{"location":"guiding_center_4d/#ChargedParticleDynamics.GuidingCenter4d.TokamakMediumCylindrical","page":"Guiding Center Dynamics in 4D","title":"ChargedParticleDynamics.GuidingCenter4d.TokamakMediumCylindrical","text":"Analytic axisymmetric medium-size tokamak equilibrium in cartesian coordinates.\n\n\n\n\n\n","category":"module"},{"location":"guiding_center_4d/#ChargedParticleDynamics.GuidingCenter4d.TokamakIterCylindrical","page":"Guiding Center Dynamics in 4D","title":"ChargedParticleDynamics.GuidingCenter4d.TokamakIterCylindrical","text":"Analytic ITER-like Solov'ev equilibrium with X-point.\n\n\n\n\n\n","category":"module"},{"location":"guiding_center_4d/#ChargedParticleDynamics.GuidingCenter4d.SolovevIter","page":"Guiding Center Dynamics in 4D","title":"ChargedParticleDynamics.GuidingCenter4d.SolovevIter","text":"Analytic ITER-like Solov'ev equilibrium.\n\n\n\n\n\n","category":"module"},{"location":"guiding_center_4d/#ChargedParticleDynamics.GuidingCenter4d.SolovevIterXpoint","page":"Guiding Center Dynamics in 4D","title":"ChargedParticleDynamics.GuidingCenter4d.SolovevIterXpoint","text":"Analytic ITER-like Solov'ev equilibrium with X-point.\n\n\n\n\n\n","category":"module"}]
}
